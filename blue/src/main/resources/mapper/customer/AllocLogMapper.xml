<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.blue.customer.alloclog.mapper.AllocLogMapper">

    <!-- 배치 INSERT -->
    <insert id="insertLogs">
        INSERT INTO alloc_logs (
        customer_id,
        action_type,
        is_final_assign,
        from_user_id,
        to_user_id,
        acted_by_user_id,
        memo
        )
        VALUES
        <foreach collection="logs" item="log" separator=",">
            (
            #{log.customerId},
            #{log.actionType},
            #{log.isFinalAssign},
            #{log.fromUserId},
            #{log.toUserId},
            #{log.actedByUserId},
            #{log.memo}
            )
        </foreach>
    </insert>

    <!-- 회수 직전 담당자 스냅샷 -->
    <select id="findOwnersByCustomerIds"
            resultType="com.blue.customer.alloclog.dto.CustomerOwnerSnapshotDto">
        SELECT
        c.customer_id     AS customerId,
        c.user_id         AS userId,
        u.user_role       AS userRole,
        c.customer_status AS status
        FROM customers c
        LEFT JOIN users u ON u.user_id = c.user_id
        WHERE c.customer_id IN
        <foreach collection="ids" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </select>

</mapper>
